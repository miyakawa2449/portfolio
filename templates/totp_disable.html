{% extends "admin/layout.html" %}

{% block title %}2æ®µéšèªè¨¼ç„¡åŠ¹åŒ–{% endblock %}

{% block head_extra %}
<style>
.totp-disable-container .alert {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
    position: static !important;
    margin-bottom: 1rem !important;
}
.totp-disable-container .alert h6,
.totp-disable-container .alert p,
.totp-disable-container .alert ul,
.totp-disable-container .alert li {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
}
</style>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">ğŸ”“ 2æ®µéšèªè¨¼ç„¡åŠ¹åŒ–</h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <a href="{{ url_for('admin.dashboard') }}" class="btn btn-sm btn-outline-secondary">
            â† ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«æˆ»ã‚‹
        </a>
    </div>
</div>

<div class="row justify-content-center">
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header bg-danger text-white">
                <h5 class="mb-0"><i class="fas fa-shield-alt me-2"></i>2æ®µéšèªè¨¼ã®ç„¡åŠ¹åŒ–</h5>
            </div>
            <div class="card-body totp-disable-container">
                
                <div class="alert alert-danger" style="position: relative; z-index: 10;">
                    <h6><i class="fas fa-exclamation-triangle me-2"></i>é‡è¦ãªè­¦å‘Š</h6>
                    <ul class="mb-2">
                        <li>2æ®µéšèªè¨¼ã‚’ç„¡åŠ¹ã«ã™ã‚‹ã¨ã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãŒå¤§å¹…ã«ä½ä¸‹ã—ã¾ã™</li>
                        <li>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ã¿ã§ãƒ­ã‚°ã‚¤ãƒ³ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™</li>
                        <li>ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹ã®ãƒªã‚¹ã‚¯ãŒé«˜ã¾ã‚Šã¾ã™</li>
                    </ul>
                    <p class="mb-0"><strong>æœ¬å½“ã«ç„¡åŠ¹åŒ–ã—ã¾ã™ã‹ï¼Ÿ</strong></p>
                </div>
                
                <div class="alert alert-info" style="position: relative; z-index: 10;">
                    <h6><i class="fas fa-info-circle me-2"></i>ç¢ºèª</h6>
                    <p class="mb-0">ç„¡åŠ¹åŒ–ã‚’ç¶šè¡Œã™ã‚‹ã«ã¯ã€ç¾åœ¨ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>
                </div>
                
                <form method="POST">
                    {{ csrf_token() }}
                    <div class="mb-4">
                        <label for="password" class="form-label">
                            <i class="fas fa-key me-2"></i>ç¾åœ¨ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
                        </label>
                        <input type="password" class="form-control form-control-lg" id="password" name="password" required 
                               placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„">
                        <div class="form-text">ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç¢ºèªã®ãŸã‚ã€ç¾åœ¨ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå¿…è¦ã§ã™</div>
                    </div>
                    
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-danger btn-lg">
                            <i class="fas fa-times me-2"></i>2æ®µéšèªè¨¼ã‚’ç„¡åŠ¹åŒ–ã™ã‚‹
                        </button>
                        <a href="{{ url_for('admin.dashboard') }}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left me-2"></i>ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                        </a>
                    </div>
                </form>
                
                <div class="mt-4 pt-3 border-top">
                    <h6><i class="fas fa-lightbulb me-2"></i>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å‘ä¸Šã®ãŸã‚ã«</h6>
                    <p class="text-muted small mb-0">
                        2æ®µéšèªè¨¼ã‚’ç„¡åŠ¹åŒ–ã™ã‚‹ä»£ã‚ã‚Šã«ã€ã‚ˆã‚Šå¼·åŠ›ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã«å¤‰æ›´ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚
                        <a href="{{ url_for('admin.edit_user', user_id=current_user.id) }}">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ã¯ã“ã¡ã‚‰</a>
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts_extra %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // è¦ç´ ã®å­˜åœ¨ç¢ºèª
    const passwordInput = document.getElementById('password');
    const submitBtn = document.querySelector('button[type="submit"]');
    const form = document.querySelector('form');
    
    if (!passwordInput || !submitBtn || !form) {
        console.warn('Required form elements not found');
        return;
    }
    
    // åˆæœŸçŠ¶æ…‹ã§ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
    submitBtn.disabled = true;
    submitBtn.style.opacity = '0.6';
    
    // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›æ™‚ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œè¨¼
    passwordInput.addEventListener('input', function() {
        if (this.value.length >= 1) {
            submitBtn.disabled = false;
            submitBtn.style.opacity = '1';
        } else {
            submitBtn.disabled = true;
            submitBtn.style.opacity = '0.6';
        }
    });
    
    // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å‰ã®æœ€çµ‚ç¢ºèª
    form.addEventListener('submit', function(e) {
        const password = passwordInput.value;
        if (password.length === 0) {
            e.preventDefault();
            alert('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
            return false;
        }
        
        if (!confirm('æœ¬å½“ã«2æ®µéšèªè¨¼ã‚’ç„¡åŠ¹åŒ–ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã«ã‚ˆã‚Šã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãŒä½ä¸‹ã—ã¾ã™ã€‚')) {
            e.preventDefault();
            return false;
        }
    });
});
</script>
{% endblock %}